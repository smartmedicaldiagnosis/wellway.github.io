<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–∞–≤–∏–≥–∞—Ç–æ—Ä –ø–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∏</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        .screen { display: none; }
        .screen.active { display: block; }
        .btn-specialty:hover { transform: translateY(-2px); }
        .route-step { animation: fadeIn 0.3s ease-out forwards; opacity: 0; }
        @keyframes fadeIn { to { opacity: 1; } }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .admin-content { display: block; }
        .admin-content.hidden { display: none; }
        .floor-card { transition: all 0.2s; }
        .floor-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .building-btn { transition: all 0.2s; }
        .building-btn:hover { transform: scale(1.02); }
        .building-btn.active { ring: 2px; }
        /* Fix for select dropdown text visibility */
        #location-select option,
        #location-select optgroup {
            color: #1f2937;
            background: white;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-blue-600 text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="max-w-lg mx-auto flex items-center justify-between">
            <div class="flex items-center gap-3">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                </svg>
                <h1 class="text-xl font-bold">–ù–∞–≤–∏–≥–∞—Ç–æ—Ä</h1>
            </div>
            <button onclick="showScreen('admin-login')" class="p-2 hover:bg-blue-700 rounded-lg transition" title="–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
            </button>
        </div>
    </header>

    <main class="max-w-lg mx-auto p-4 pb-24">
        <!-- Screen: Start -->
        <div id="screen-start" class="screen active">
            <div class="text-center mb-6 mt-4">
                <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-10 h-10 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">–ù–∞–π—Ç–∏ –∫–∞–±–∏–Ω–µ—Ç</h2>
            </div>

            <!-- Location Selection -->
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-2xl shadow-lg p-5 mb-6 text-white">
                <div class="flex items-center gap-2 mb-3">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                    <span class="font-semibold">–ì–¥–µ –≤—ã —Å–µ–π—á–∞—Å –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å?</span>
                </div>
                
                <!-- Building Selection -->
                <div class="mb-3">
                    <p class="text-blue-100 text-sm mb-2">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–ø—É—Å:</p>
                    <div id="building-buttons" class="flex flex-wrap gap-2">
                        <!-- Populated by JS -->
                    </div>
                </div>
                
                <!-- Location in Building -->
                <div>
                    <p class="text-blue-100 text-sm mb-2">–£—Ç–æ—á–Ω–∏—Ç–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</p>
                    <select id="location-select" onchange="updateCurrentLocation()" 
                            class="w-full bg-white/20 backdrop-blur border-2 border-white/30 rounded-xl px-4 py-3 text-white placeholder-white/70 focus:border-white focus:outline-none">
                        <!-- Populated by JS -->
                    </select>
                </div>
                
                <div class="mt-3 pt-3 border-t border-white/20">
                    <p class="text-sm">
                        <span class="text-blue-100">–¢–µ–∫—É—â–∞—è —Ç–æ—á–∫–∞:</span>
                        <span id="current-location-text" class="font-medium ml-1">–ì–ª–∞–≤–Ω—ã–π –∫–æ—Ä–ø—É—Å ‚Äî –í—Ö–æ–¥</span>
                    </p>
                </div>
            </div>

            <!-- Option 1: Room Number -->
            <div class="bg-white rounded-2xl shadow-md p-6 mb-4">
                <h3 class="font-semibold text-lg text-gray-700 mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center text-green-600 font-bold">1</span>
                    –Ø –∑–Ω–∞—é –Ω–æ–º–µ—Ä –∫–∞–±–∏–Ω–µ—Ç–∞
                </h3>
                <div class="flex gap-2">
                    <input type="text" id="room-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 314" 
                           class="flex-1 border-2 border-gray-200 rounded-xl px-4 py-3 text-lg focus:border-blue-500 focus:outline-none transition"
                           inputmode="numeric">
                    <button onclick="searchByRoom()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-xl font-semibold transition">
                        –ù–∞–π—Ç–∏
                    </button>
                </div>
            </div>

            <!-- Divider -->
            <div class="flex items-center gap-4 my-6">
                <div class="flex-1 h-px bg-gray-300"></div>
                <span class="text-gray-400 font-medium">–ò–õ–ò</span>
                <div class="flex-1 h-px bg-gray-300"></div>
            </div>

            <!-- Option 2: Specialty -->
            <div class="bg-white rounded-2xl shadow-md p-6 mb-6">
                <h3 class="font-semibold text-lg text-gray-700 mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold">2</span>
                    –Ø –∏—â—É —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞
                </h3>
                <button onclick="showScreen('specialties')" 
                        class="w-full bg-blue-500 hover:bg-blue-600 text-white py-4 rounded-xl font-semibold text-lg transition flex items-center justify-center gap-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                    –í—ã–±—Ä–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å
                </button>
            </div>

            <!-- Help Button -->
            <button onclick="showHelp()" class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 py-4 rounded-xl font-medium transition flex items-center justify-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?
            </button>
        </div>

        <!-- Screen: Specialties -->
        <div id="screen-specialties" class="screen">
            <button onclick="showScreen('start')" class="flex items-center gap-2 text-blue-600 mb-4 font-medium">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
                –ù–∞–∑–∞–¥
            </button>

            <h2 class="text-2xl font-bold text-gray-800 mb-4">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞</h2>

            <!-- Search -->
            <div class="relative mb-6">
                <input type="text" id="specialty-search" placeholder="–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å..." 
                       oninput="filterSpecialties()"
                       class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 pl-12 text-lg focus:border-blue-500 focus:outline-none transition">
                <svg class="w-6 h-6 text-gray-400 absolute left-4 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
            </div>

            <!-- Specialty List -->
            <div id="specialty-list" class="space-y-3">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- Screen: Room Selection -->
        <div id="screen-rooms" class="screen">
            <button onclick="showScreen('specialties')" class="flex items-center gap-2 text-blue-600 mb-4 font-medium">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
                –ù–∞–∑–∞–¥
            </button>

            <h2 class="text-2xl font-bold text-gray-800 mb-2">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–±–∏–Ω–µ—Ç</h2>
            <p class="text-gray-500 mb-6" id="rooms-specialty-name">–ù–∞–π–¥–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞–±–∏–Ω–µ—Ç–æ–≤</p>

            <div id="room-list" class="space-y-3">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- Screen: Route -->
        <div id="screen-route" class="screen">
            <button onclick="showScreen('start')" class="flex items-center gap-2 text-blue-600 mb-4 font-medium">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
                –ù–æ–≤—ã–π –ø–æ–∏—Å–∫
            </button>

            <div class="bg-green-50 border-2 border-green-200 rounded-2xl p-4 mb-6">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                    </div>
                    <div>
                        <p class="text-gray-500 text-sm">–í–∞—à–∞ —Ü–µ–ª—å</p>
                        <p class="font-bold text-lg text-gray-800" id="route-target">–ö–∞–±–∏–Ω–µ—Ç 314</p>
                        <p class="text-blue-600 text-sm" id="route-building"></p>
                    </div>
                </div>
            </div>

            <h3 class="font-semibold text-lg text-gray-700 mb-4">–ú–∞—Ä—à—Ä—É—Ç:</h3>

            <div id="route-steps" class="space-y-4 mb-6">
                <!-- Populated by JS -->
            </div>

            <!-- Update Location -->
            <div class="bg-blue-50 border-2 border-blue-200 rounded-2xl p-4 mt-6">
                <div class="flex items-start gap-3">
                    <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </div>
                    <div class="flex-1">
                        <p class="font-semibold text-gray-800 mb-2">–û–±–Ω–æ–≤–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</p>
                        <p class="text-gray-600 text-sm mb-3">–ï—Å–ª–∏ –≤—ã –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∏—Å—å, —É–∫–∞–∂–∏—Ç–µ –Ω–æ–≤—É—é —Ç–æ—á–∫—É –¥–ª—è –ø–µ—Ä–µ—Å—á—ë—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–∞</p>
                        <select id="route-location-select" onchange="updateLocationFromRoute()" 
                                class="w-full border-2 border-blue-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none bg-white">
                            <!-- Populated by JS -->
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Screen: Help -->
        <div id="screen-help" class="screen">
            <button onclick="showScreen('start')" class="flex items-center gap-2 text-blue-600 mb-4 font-medium">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
                –ù–∞–∑–∞–¥
            </button>

            <h2 class="text-2xl font-bold text-gray-800 mb-6">–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?</h2>

            <div class="space-y-4" id="help-content">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- Screen: Admin Login -->
        <div id="screen-admin-login" class="screen">
            <button onclick="showScreen('start')" class="flex items-center gap-2 text-blue-600 mb-4 font-medium">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
                –ù–∞–∑–∞–¥
            </button>

            <h2 class="text-2xl font-bold text-gray-800 mb-6">–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>

            <div class="bg-white rounded-2xl shadow-md p-6">
                <div class="mb-4">
                    <label class="block text-gray-700 font-medium mb-2">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="admin-password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
                           class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none transition">
                </div>
                <button onclick="adminLogin()" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-xl font-semibold transition">
                    –í–æ–π—Ç–∏
                </button>
                <p class="text-center text-gray-400 text-sm mt-4" id="demo-password-hint">–î–µ–º–æ-–ø–∞—Ä–æ–ª—å: admin</p>
            </div>
        </div>

        <!-- Screen: Admin Panel -->
        <div id="screen-admin" class="screen">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-800">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
                <button onclick="showScreen('start')" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <!-- Tabs -->
            <div class="flex gap-1 mb-6 bg-gray-100 p-1 rounded-xl overflow-x-auto">
                <button onclick="switchAdminTab('buildings')" id="tab-buildings" 
                        class="flex-1 py-2 px-2 rounded-lg font-medium transition text-xs bg-white shadow text-gray-800 whitespace-nowrap">
                    üè¢ –ö–æ—Ä–ø—É—Å–∞
                </button>
                <button onclick="switchAdminTab('floors')" id="tab-floors" 
                        class="flex-1 py-2 px-2 rounded-lg font-medium transition text-xs text-gray-600 whitespace-nowrap">
                    üèóÔ∏è –≠—Ç–∞–∂–∏
                </button>
                <button onclick="switchAdminTab('specialties')" id="tab-specialties" 
                        class="flex-1 py-2 px-2 rounded-lg font-medium transition text-xs text-gray-600 whitespace-nowrap">
                    üë®‚Äç‚öïÔ∏è –°–ø–µ—Ü.
                </button>
                <button onclick="switchAdminTab('offices')" id="tab-offices"
                        class="flex-1 py-2 px-2 rounded-lg font-medium transition text-xs text-gray-600 whitespace-nowrap">
                    üö™ –ö–∞–±–∏–Ω–µ—Ç—ã
                </button>
                <button onclick="switchAdminTab('settings')" id="tab-settings"
                        class="flex-1 py-2 px-2 rounded-lg font-medium transition text-xs text-gray-600 whitespace-nowrap">
                    ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                </button>
            </div>

            <!-- Admin: Buildings -->
            <div id="admin-buildings" class="admin-content">
                <button onclick="showAddBuilding()" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-semibold mb-4 flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                    </svg>
                    –î–æ–±–∞–≤–∏—Ç—å –∫–æ—Ä–ø—É—Å
                </button>

                <div id="admin-building-list" class="space-y-3">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Admin: Floors -->
            <div id="admin-floors" class="admin-content hidden">
                <div class="mb-4">
                    <label class="block text-gray-700 font-medium mb-2">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–ø—É—Å</label>
                    <select id="admin-floor-building-select" onchange="renderAdminFloors()" class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                        <!-- Populated by JS -->
                    </select>
                </div>

                <button onclick="showAddFloor()" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-semibold mb-4 flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                    </svg>
                    –î–æ–±–∞–≤–∏—Ç—å —ç—Ç–∞–∂
                </button>

                <div id="admin-floor-list" class="space-y-3">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Admin: Specialties -->
            <div id="admin-specialties" class="admin-content hidden">
                <button onclick="showAddSpecialty()" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-semibold mb-4 flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                    </svg>
                    –î–æ–±–∞–≤–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å
                </button>

                <div id="admin-specialty-list" class="space-y-3">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Admin: Offices -->
            <div id="admin-offices" class="admin-content hidden">
                <button onclick="showAddOffice()" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-semibold mb-4 flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                    </svg>
                    –î–æ–±–∞–≤–∏—Ç—å –∫–∞–±–∏–Ω–µ—Ç
                </button>

                <!-- Filter by building -->
                <div class="mb-4">
                    <select id="admin-office-filter" onchange="renderAdminOffices()" class="w-full border-2 border-gray-200 rounded-xl px-4 py-2 focus:border-blue-500 focus:outline-none">
                        <option value="">–í—Å–µ –∫–æ—Ä–ø—É—Å–∞</option>
                    </select>
                </div>

                <div id="admin-office-list" class="space-y-3">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Admin: Settings -->
            <div id="admin-settings" class="admin-content hidden">
                <div class="space-y-4">
                    <!-- Password -->
                    <div class="bg-white rounded-xl p-5 shadow-sm border border-gray-100">
                        <h3 class="font-bold text-lg text-gray-800 mb-4 flex items-center gap-2">
                            <span class="text-xl">üîê</span> –ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
                                <input type="password" id="settings-current-password" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å"
                                       class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                                <input type="password" id="settings-new-password" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å"
                                       class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                                <input type="password" id="settings-confirm-password" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å"
                                       class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                            </div>
                            <button onclick="changePassword()" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-xl font-semibold transition">
                                –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
                            </button>
                        </div>
                    </div>

                    <!-- Phone -->
                    <div class="bg-white rounded-xl p-5 shadow-sm border border-gray-100">
                        <h3 class="font-bold text-lg text-gray-800 mb-4 flex items-center gap-2">
                            <span class="text-xl">üìû</span> –¢–µ–ª–µ—Ñ–æ–Ω —Å–ø—Ä–∞–≤–æ—á–Ω–æ–π
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                                <input type="tel" id="settings-phone" placeholder="8-800-123-45-67"
                                       class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                                <input type="text" id="settings-phone-desc" placeholder="–ë–µ—Å–ø–ª–∞—Ç–Ω–æ –ø–æ –†–æ—Å—Å–∏–∏"
                                       class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                            </div>
                        </div>
                    </div>

                    <!-- Registry -->
                    <div class="bg-white rounded-xl p-5 shadow-sm border border-gray-100">
                        <h3 class="font-bold text-lg text-gray-800 mb-4 flex items-center gap-2">
                            <span class="text-xl">üìç</span> –†–µ–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä–∞
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</label>
                                <input type="text" id="settings-registry-location" placeholder="–ì–ª–∞–≤–Ω—ã–π –∫–æ—Ä–ø—É—Å, 1 —ç—Ç–∞–∂, –Ω–∞–ø—Ä–æ—Ç–∏–≤ –≤—Ö–æ–¥–∞"
                                       class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã</label>
                                <input type="text" id="settings-registry-hours" placeholder="–ü–Ω-–ü—Ç 8:00-19:00, –°–± 9:00-15:00"
                                       class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                            </div>
                        </div>
                    </div>

                    <!-- Emergency -->
                    <div class="bg-white rounded-xl p-5 shadow-sm border border-gray-100">
                        <h3 class="font-bold text-lg text-gray-800 mb-4 flex items-center gap-2">
                            <span class="text-xl">üÜò</span> –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –ø–æ–º–æ—â—å
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</label>
                                <input type="text" id="settings-emergency-location" placeholder="–ö–∞–±–∏–Ω–µ—Ç 101 (–ì–ª–∞–≤–Ω—ã–π –∫–æ—Ä–ø—É—Å, 1 —ç—Ç–∞–∂)"
                                       class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">–¢–µ–ª–µ—Ñ–æ–Ω —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–π –ø–æ–º–æ—â–∏</label>
                                <input type="tel" id="settings-emergency-phone" placeholder="103 –∏–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä"
                                       class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                            </div>
                        </div>
                    </div>

                    <!-- Save Button -->
                    <button onclick="saveSettings()" class="w-full bg-green-500 hover:bg-green-600 text-white py-4 rounded-xl font-semibold text-lg transition flex items-center justify-center gap-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal: Add/Edit Building -->
        <div id="modal-building" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto">
                <h3 class="text-xl font-bold mb-4" id="modal-building-title">–î–æ–±–∞–≤–∏—Ç—å –∫–æ—Ä–ø—É—Å</h3>
                <input type="hidden" id="edit-building-id">
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">ID –∫–æ—Ä–ø—É—Å–∞ (–ª–∞—Ç–∏–Ω–∏—Ü–∞) *</label>
                        <input type="text" id="building-id-input" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: main –∏–ª–∏ small"
                               class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ—Ä–ø—É—Å–∞ *</label>
                        <input type="text" id="building-name-input" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –ì–ª–∞–≤–Ω—ã–π –∫–æ—Ä–ø—É—Å"
                               class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">–ö–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" id="building-short-input" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –ì–ª–∞–≤–Ω—ã–π"
                               class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">–ê–¥—Ä–µ—Å / –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                        <input type="text" id="building-address-input" placeholder="—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 1"
                               class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">–¶–≤–µ—Ç (–¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è)</label>
                        <select id="building-color-input" class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                            <option value="blue">üîµ –°–∏–Ω–∏–π</option>
                            <option value="green">üü¢ –ó–µ–ª—ë–Ω—ã–π</option>
                            <option value="purple">üü£ –§–∏–æ–ª–µ—Ç–æ–≤—ã–π</option>
                            <option value="orange">üü† –û—Ä–∞–Ω–∂–µ–≤—ã–π</option>
                            <option value="red">üî¥ –ö—Ä–∞—Å–Ω—ã–π</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">–°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º –∫–æ—Ä–ø—É—Å–æ–º</label>
                        <select id="building-connection-input" class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                            <option value="">–ù–µ—Ç —Å–≤—è–∑–∏ (–æ—Ç–¥–µ–ª—å–Ω–æ–µ –∑–¥–∞–Ω–∏–µ)</option>
                        </select>
                        <p class="text-gray-400 text-xs mt-1">–ï—Å–ª–∏ –∫–æ—Ä–ø—É—Å–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω—ã –ø–µ—Ä–µ—Ö–æ–¥–æ–º</p>
                    </div>
                </div>

                <div class="flex gap-3 mt-6">
                    <button onclick="closeModal('building')" class="flex-1 bg-gray-200 hover:bg-gray-300 py-3 rounded-xl font-medium transition">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button onclick="saveBuilding()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-xl font-semibold transition">
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal: Add/Edit Floor -->
        <div id="modal-floor" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto">
                <h3 class="text-xl font-bold mb-4" id="modal-floor-title">–î–æ–±–∞–≤–∏—Ç—å —ç—Ç–∞–∂</h3>
                <input type="hidden" id="edit-floor-id">
                <input type="hidden" id="edit-floor-building">
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">–ù–æ–º–µ—Ä —ç—Ç–∞–∂–∞ *</label>
                        <input type="number" id="floor-number-input" placeholder="1" min="-2" max="50"
                               class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                        <p class="text-gray-400 text-xs mt-1">–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–æ–¥–≤–∞–ª—å–Ω—ã—Ö —ç—Ç–∞–∂–µ–π</p>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ —ç—Ç–∞–∂–∞</label>
                        <input type="text" id="floor-name-input" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –¶–æ–∫–æ–ª—å–Ω—ã–π —ç—Ç–∞–∂, –ú–µ–∑–æ–Ω–∏–Ω"
                               class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                        <p class="text-gray-400 text-xs mt-1">–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è</p>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">–î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–æ–Ω—ã/–∫—Ä—ã–ª—å—è *</label>
                        <div class="space-y-2" id="floor-zones-container">
                            <label class="flex items-center gap-2">
                                <input type="checkbox" id="floor-zone-left" value="left" checked class="w-5 h-5 rounded">
                                <span>‚¨ÖÔ∏è –õ–µ–≤–æ–µ –∫—Ä—ã–ª–æ</span>
                            </label>
                            <label class="flex items-center gap-2">
                                <input type="checkbox" id="floor-zone-center" value="center" checked class="w-5 h-5 rounded">
                                <span>üèõÔ∏è –¶–µ–Ω—Ç—Ä / –•–æ–ª–ª</span>
                            </label>
                            <label class="flex items-center gap-2">
                                <input type="checkbox" id="floor-zone-right" value="right" checked class="w-5 h-5 rounded">
                                <span>‚û°Ô∏è –ü—Ä–∞–≤–æ–µ –∫—Ä—ã–ª–æ</span>
                            </label>
                        </div>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–æ–Ω—ã</label>
                        <input type="text" id="floor-custom-zones-input" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: —Å–µ–≤–µ—Ä–Ω–æ–µ –∫—Ä—ã–ª–æ, —é–∂–Ω–æ–µ –∫—Ä—ã–ª–æ"
                               class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                        <p class="text-gray-400 text-xs mt-1">–ß–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é, –ª–∞—Ç–∏–Ω—Å–∫–∏–µ ID</p>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <input type="text" id="floor-description-input" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π —ç—Ç–∞–∂"
                               class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                    </div>
                    <div class="flex items-center gap-3">
                        <input type="checkbox" id="floor-has-elevator" class="w-5 h-5 rounded">
                        <label for="floor-has-elevator" class="text-gray-700">üõó –ï—Å—Ç—å –ª–∏—Ñ—Ç –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–∂–µ</label>
                    </div>
                </div>

                <div class="flex gap-3 mt-6">
                    <button onclick="closeModal('floor')" class="flex-1 bg-gray-200 hover:bg-gray-300 py-3 rounded-xl font-medium transition">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button onclick="saveFloor()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-xl font-semibold transition">
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal: Add/Edit Specialty -->
        <div id="modal-specialty" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl p-6 w-full max-w-md">
                <h3 class="text-xl font-bold mb-4" id="modal-specialty-title">–î–æ–±–∞–≤–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</h3>
                <input type="hidden" id="edit-specialty-id">
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">ID (–ª–∞—Ç–∏–Ω–∏—Ü–∞)</label>
                        <input type="text" id="specialty-id-input" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: cardiologist"
                               class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" id="specialty-name-input" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –ö–∞—Ä–¥–∏–æ–ª–æ–≥"
                               class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">–°–∏–Ω–æ–Ω–∏–º—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
                        <input type="text" id="specialty-aliases-input" placeholder="—Å–µ—Ä–¥—Ü–µ, —Å–µ—Ä–¥–µ—á–Ω—ã–π –≤—Ä–∞—á"
                               class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">–ò–∫–æ–Ω–∫–∞ (—ç–º–æ–¥–∑–∏)</label>
                        <input type="text" id="specialty-icon-input" placeholder="‚ù§Ô∏è"
                               class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                    </div>
                </div>

                <div class="flex gap-3 mt-6">
                    <button onclick="closeModal('specialty')" class="flex-1 bg-gray-200 hover:bg-gray-300 py-3 rounded-xl font-medium transition">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button onclick="saveSpecialty()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-xl font-semibold transition">
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal: Add/Edit Office -->
        <div id="modal-office" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto">
                <h3 class="text-xl font-bold mb-4" id="modal-office-title">–î–æ–±–∞–≤–∏—Ç—å –∫–∞–±–∏–Ω–µ—Ç</h3>
                <input type="hidden" id="edit-office-id">
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">–ö–æ—Ä–ø—É—Å *</label>
                        <select id="office-building-input" onchange="updateOfficeFloorOptions()" class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">–ù–æ–º–µ—Ä –∫–∞–±–∏–Ω–µ—Ç–∞ *</label>
                        <input type="text" id="office-number-input" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: 314"
                               class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" id="office-name-input" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –ö–∞–±–∏–Ω–µ—Ç –æ–∫—É–ª–∏—Å—Ç–∞"
                               class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å *</label>
                        <select id="office-specialty-input" class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">–≠—Ç–∞–∂ *</label>
                            <select id="office-floor-input" onchange="updateOfficeWingOptions()" class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                                <!-- Populated by JS -->
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">–ó–æ–Ω–∞/–ö—Ä—ã–ª–æ *</label>
                            <select id="office-wing-input" class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                                <!-- Populated by JS -->
                            </select>
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    <p class="text-gray-500 text-sm">–ü–æ–ª—è –¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:</p>
                    
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">–§–ò–û –≤—Ä–∞—á–∞</label>
                        <input type="text" id="office-doctor-input" placeholder="–ò–≤–∞–Ω–æ–≤ –ò.–ò."
                               class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</label>
                        <input type="text" id="office-schedule-input" placeholder="–ü–Ω-–ü—Ç 9:00-15:00"
                               class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:outline-none">
                    </div>
                    <div class="flex items-center gap-3">
                        <input type="checkbox" id="office-active-input" checked class="w-5 h-5">
                        <label for="office-active-input" class="text-gray-700 font-medium">–ö–∞–±–∏–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç</label>
                    </div>
                </div>

                <div class="flex gap-3 mt-6">
                    <button onclick="closeModal('office')" class="flex-1 bg-gray-200 hover:bg-gray-300 py-3 rounded-xl font-medium transition">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button onclick="saveOffice()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-xl font-semibold transition">
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>

        <!-- Toast Notification -->
        <div id="toast" class="fixed bottom-4 left-4 right-4 bg-gray-800 text-white py-3 px-4 rounded-xl shadow-lg transform translate-y-full transition-transform duration-300 z-50 max-w-lg mx-auto">
            <span id="toast-message">–°–æ–æ–±—â–µ–Ω–∏–µ</span>
        </div>
    </main>

    <script>
        // ==================== DATA ====================
        
        // Buildings / –ö–æ—Ä–ø—É—Å–∞
        let buildings = {
            main: { 
                name: "–ì–ª–∞–≤–Ω—ã–π –∫–æ—Ä–ø—É—Å", 
                short_name: "–ì–ª–∞–≤–Ω—ã–π",
                address: "—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 1",
                color: "blue",
                connections: ["small"]
            },
            small: { 
                name: "–ú–∞–ª—ã–π –∫–æ—Ä–ø—É—Å", 
                short_name: "–ú–∞–ª—ã–π",
                address: "—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 1, —Å—Ç—Ä. 2",
                color: "green",
                connections: ["main"]
            },
            diagnostic: {
                name: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π –∫–æ—Ä–ø—É—Å",
                short_name: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞",
                address: "—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 3",
                color: "purple",
                connections: []
            }
        };

        // Floors / –≠—Ç–∞–∂–∏
        let floors = {
            "main_1": { building_id: "main", number: 1, name: "", zones: ["left", "center", "right"], custom_zones: [], description: "–†–µ–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä–∞, –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω—ã–µ", has_elevator: true },
            "main_2": { building_id: "main", number: 2, name: "", zones: ["left", "center", "right"], custom_zones: [], description: "–¢–µ—Ä–∞–ø–µ–≤—Ç—ã, –æ—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥–∏—è", has_elevator: true },
            "main_3": { building_id: "main", number: 3, name: "", zones: ["left", "center", "right"], custom_zones: [], description: "–•–∏—Ä—É—Ä–≥–∏—è, –∫–∞—Ä–¥–∏–æ–ª–æ–≥–∏—è", has_elevator: true },
            "small_1": { building_id: "small", number: 1, name: "", zones: ["left", "center", "right"], custom_zones: [], description: "–£–ó–ò-–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞", has_elevator: false },
            "small_2": { building_id: "small", number: 2, name: "", zones: ["left", "center", "right"], custom_zones: [], description: "–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤", has_elevator: false },
            "diagnostic_1": { building_id: "diagnostic", number: 1, name: "", zones: ["center"], custom_zones: [], description: "–ú–†–¢, –ö–¢", has_elevator: true },
            "diagnostic_2": { building_id: "diagnostic", number: 2, name: "", zones: ["left", "center"], custom_zones: [], description: "–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è", has_elevator: true }
        };
        
        let specialties = {
            therapist: { name: "–¢–µ—Ä–∞–ø–µ–≤—Ç", aliases: ["–≤—Ä–∞—á", "–æ–±—â–∏–π –≤—Ä–∞—á"], icon: "ü©∫" },
            ophthalmologist: { name: "–û–∫—É–ª–∏—Å—Ç", aliases: ["–≥–ª–∞–∑–Ω–æ–π –≤—Ä–∞—á", "–æ—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥", "–≥–ª–∞–∑–∞"], icon: "üëÅÔ∏è" },
            ent: { name: "–û—Ç–æ–ª–∞—Ä–∏–Ω–≥–æ–ª–æ–≥ (–õ–û–†)", aliases: ["–ª–æ—Ä", "—É—Ö–æ –≥–æ—Ä–ª–æ –Ω–æ—Å", "—É—Ö–æ–≥–æ—Ä–ª–æ–Ω–æ—Å"], icon: "üëÇ" },
            surgeon: { name: "–•–∏—Ä—É—Ä–≥", aliases: ["—Ö–∏—Ä—É—Ä–≥–∏—è", "–æ–ø–µ—Ä–∞—Ü–∏—è"], icon: "üî™" },
            traumatologist: { name: "–¢—Ä–∞–≤–º–∞—Ç–æ–ª–æ–≥", aliases: ["—Ç—Ä–∞–≤–º–∞", "–ø–µ—Ä–µ–ª–æ–º", "–æ—Ä—Ç–æ–ø–µ–¥"], icon: "ü¶¥" },
            ultrasound: { name: "–£–ó–ò", aliases: ["—É–ª—å—Ç—Ä–∞–∑–≤—É–∫", "–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞", "—É–∑–∏-–∫–∞–±–∏–Ω–µ—Ç"], icon: "üì°" },
            cardiologist: { name: "–ö–∞—Ä–¥–∏–æ–ª–æ–≥", aliases: ["—Å–µ—Ä–¥—Ü–µ", "—Å–µ—Ä–¥–µ—á–Ω—ã–π –≤—Ä–∞—á"], icon: "‚ù§Ô∏è" },
            neurologist: { name: "–ù–µ–≤—Ä–æ–ª–æ–≥", aliases: ["–Ω–µ—Ä–≤—ã", "–Ω–µ–≤—Ä–æ–ø–∞—Ç–æ–ª–æ–≥"], icon: "üß†" },
            dentist: { name: "–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥", aliases: ["–∑—É–±–Ω–æ–π –≤—Ä–∞—á", "–∑—É–±—ã", "–¥–∞–Ω—Ç–∏—Å—Ç"], icon: "ü¶∑" },
            lab: { name: "–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è (–∞–Ω–∞–ª–∏–∑—ã)", aliases: ["–∞–Ω–∞–ª–∏–∑—ã", "–∫—Ä–æ–≤—å", "–∑–∞–±–æ—Ä –∫—Ä–æ–≤–∏"], icon: "üß™" },
            procedures: { name: "–ü—Ä–æ—Ü–µ–¥—É—Ä–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç", aliases: ["–ø—Ä–æ—Ü–µ–¥—É—Ä—ã", "—É–∫–æ–ª—ã", "–∫–∞–ø–µ–ª—å–Ω–∏—Ü–∞"], icon: "üíâ" },
            xray: { name: "–†–µ–Ω—Ç–≥–µ–Ω", aliases: ["—Ä–µ–Ω—Ç–≥–µ–Ω–æ–≥—Ä–∞—Ñ–∏—è", "—Å–Ω–∏–º–æ–∫"], icon: "‚ò¢Ô∏è" },
            mri: { name: "–ú–†–¢", aliases: ["—Ç–æ–º–æ–≥—Ä–∞—Ñ–∏—è", "–º–∞–≥–Ω–∏—Ç–Ω–æ-—Ä–µ–∑–æ–Ω–∞–Ω—Å–Ω–∞—è"], icon: "üß≤" },
            ct: { name: "–ö–¢", aliases: ["–∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–∞—è —Ç–æ–º–æ–≥—Ä–∞—Ñ–∏—è"], icon: "üíª" }
        };

        let offices = {
            "main_101": { building_id: "main", floor: 1, wing: "left", specialty_id: "procedures", display_name: "–ü—Ä–æ—Ü–µ–¥—É—Ä–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç", doctor_name: "", schedule: "–ü–Ω-–ü—Ç 8:00-14:00", is_active: true },
            "main_102": { building_id: "main", floor: 1, wing: "left", specialty_id: "lab", display_name: "–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è", doctor_name: "–ü–µ—Ç—Ä–æ–≤–∞ –ú.–ò.", schedule: "–ü–Ω-–ü—Ç 7:30-12:00", is_active: true },
            "main_105": { building_id: "main", floor: 1, wing: "right", specialty_id: "xray", display_name: "–ö–∞–±–∏–Ω–µ—Ç —Ä–µ–Ω—Ç–≥–µ–Ω–∞", doctor_name: "–°–∏–¥–æ—Ä–æ–≤ –ö.–ü.", schedule: "–ü–Ω-–ü—Ç 9:00-17:00", is_active: true },
            "main_201": { building_id: "main", floor: 2, wing: "left", specialty_id: "therapist", display_name: "–¢–µ—Ä–∞–ø–µ–≤—Ç (—É—á–∞—Å—Ç–æ–∫ 1)", doctor_name: "–ö–æ–∑–ª–æ–≤–∞ –ê.–í.", schedule: "–ü–Ω-–ü—Ç 8:00-15:00", is_active: true },
            "main_202": { building_id: "main", floor: 2, wing: "left", specialty_id: "therapist", display_name: "–¢–µ—Ä–∞–ø–µ–≤—Ç (—É—á–∞—Å—Ç–æ–∫ 2)", doctor_name: "–ù–∏–∫–æ–ª–∞–µ–≤ –î.–°.", schedule: "–ü–Ω-–ü—Ç 14:00-20:00", is_active: true },
            "main_210": { building_id: "main", floor: 2, wing: "right", specialty_id: "ophthalmologist", display_name: "–ö–∞–±–∏–Ω–µ—Ç –æ–∫—É–ª–∏—Å—Ç–∞", doctor_name: "–ò–≤–∞–Ω–æ–≤–∞ –ê.–°.", schedule: "–ü–Ω-–ü—Ç 9:00-15:00", is_active: true },
            "main_212": { building_id: "main", floor: 2, wing: "right", specialty_id: "ophthalmologist", display_name: "–û–∫—É–ª–∏—Å—Ç (–¥–µ—Ç—Å–∫–∏–π)", doctor_name: "–°–º–∏—Ä–Ω–æ–≤–∞ –ï.–í.", schedule: "–ü–Ω-–ü—Ç 10:00-16:00", is_active: true },
            "main_215": { building_id: "main", floor: 2, wing: "right", specialty_id: "ent", display_name: "–õ–û–†-–∫–∞–±–∏–Ω–µ—Ç", doctor_name: "–í–∞—Å–∏–ª—å–µ–≤ –ù.–ê.", schedule: "–ü–Ω-–°–± 9:00-18:00", is_active: true },
            "main_301": { building_id: "main", floor: 3, wing: "left", specialty_id: "surgeon", display_name: "–ö–∞–±–∏–Ω–µ—Ç —Ö–∏—Ä—É—Ä–≥–∞", doctor_name: "–§–µ–¥–æ—Ä–æ–≤ –°.–ü.", schedule: "–ü–Ω-–ü—Ç 8:00-14:00", is_active: true },
            "main_305": { building_id: "main", floor: 3, wing: "left", specialty_id: "traumatologist", display_name: "–¢—Ä–∞–≤–º–∞—Ç–æ–ª–æ–≥", doctor_name: "–û—Ä–ª–æ–≤ –ú.–ö.", schedule: "–ü–Ω-–ü—Ç 9:00-17:00", is_active: true },
            "main_314": { building_id: "main", floor: 3, wing: "right", specialty_id: "cardiologist", display_name: "–ö–∞–±–∏–Ω–µ—Ç –∫–∞—Ä–¥–∏–æ–ª–æ–≥–∞", doctor_name: "–†–æ–º–∞–Ω–æ–≤ –í.–ï.", schedule: "–ü–Ω-–ü—Ç 10:00-18:00", is_active: true },
            "main_320": { building_id: "main", floor: 3, wing: "center", specialty_id: "neurologist", display_name: "–ù–µ–≤—Ä–æ–ª–æ–≥", doctor_name: "–ö–Ω—è–∑–µ–≤–∞ –¢.–°.", schedule: "–ü–Ω-–ß—Ç 9:00-16:00", is_active: true },
            "main_118": { building_id: "main", floor: 1, wing: "center", specialty_id: "dentist", display_name: "–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—è", doctor_name: "–ó—É–±–æ–≤ –ò.–ò.", schedule: "–ü–Ω-–ü—Ç 8:00-20:00", is_active: true },
            "small_101": { building_id: "small", floor: 1, wing: "left", specialty_id: "ultrasound", display_name: "–£–ó–ò –±—Ä—é—à–Ω–æ–π –ø–æ–ª–æ—Å—Ç–∏", doctor_name: "–ú–æ—Ä–æ–∑–æ–≤–∞ –õ.–ò.", schedule: "–ü–Ω-–ü—Ç 8:00-16:00", is_active: true },
            "small_102": { building_id: "small", floor: 1, wing: "right", specialty_id: "ultrasound", display_name: "–£–ó–ò —Å–µ—Ä–¥—Ü–∞ (–≠—Ö–æ–ö–ì)", doctor_name: "–ë–µ–ª–æ–≤ –ê.–†.", schedule: "–ü–Ω-–°–± 9:00-15:00", is_active: true },
            "small_201": { building_id: "small", floor: 2, wing: "left", specialty_id: "cardiologist", display_name: "–ö–∞—Ä–¥–∏–æ–ª–æ–≥ (–ø—Ä–∏—ë–º)", doctor_name: "–°–µ—Ä–¥—Ü–µ–≤ –ê.–ê.", schedule: "–ü–Ω-–ü—Ç 9:00-17:00", is_active: true },
            "small_202": { building_id: "small", floor: 2, wing: "right", specialty_id: "neurologist", display_name: "–ù–µ–≤—Ä–æ–ª–æ–≥ (–¥–µ—Ç—Å–∫–∏–π)", doctor_name: "–£–º–Ω–æ–≤–∞ –ï.–°.", schedule: "–ü–Ω-–ü—Ç 10:00-16:00", is_active: true },
            "diagnostic_101": { building_id: "diagnostic", floor: 1, wing: "center", specialty_id: "mri", display_name: "–ö–∞–±–∏–Ω–µ—Ç –ú–†–¢", doctor_name: "–õ—É—á–µ–≤ –†.–ê.", schedule: "–ü–Ω-–°–± 8:00-20:00", is_active: true },
            "diagnostic_102": { building_id: "diagnostic", floor: 1, wing: "center", specialty_id: "ct", display_name: "–ö–∞–±–∏–Ω–µ—Ç –ö–¢", doctor_name: "–¢–æ–º–æ–≤ –ö.–ö.", schedule: "–ü–Ω-–°–± 8:00-20:00", is_active: true },
            "diagnostic_201": { building_id: "diagnostic", floor: 2, wing: "left", specialty_id: "lab", display_name: "–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è)", doctor_name: "–ê–Ω–∞–ª–∏–∑–æ–≤–∞ –¢.–¢.", schedule: "–ü–Ω-–ü—Ç 7:00-14:00", is_active: true }
        };

        // Settings / –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        let settings = {
            adminPassword: "admin",
            phone: "8-800-123-45-67",
            phoneDesc: "–ë–µ—Å–ø–ª–∞—Ç–Ω–æ –ø–æ –†–æ—Å—Å–∏–∏",
            registryLocation: "–ì–ª–∞–≤–Ω—ã–π –∫–æ—Ä–ø—É—Å, 1 —ç—Ç–∞–∂, –Ω–∞–ø—Ä–æ—Ç–∏–≤ –≤—Ö–æ–¥–∞",
            registryHours: "–ü–Ω-–ü—Ç 8:00-19:00, –°–± 9:00-15:00",
            emergencyLocation: "–ö–∞–±–∏–Ω–µ—Ç 101 (–ì–ª–∞–≤–Ω—ã–π –∫–æ—Ä–ø—É—Å, 1 —ç—Ç–∞–∂, –ª–µ–≤–æ–µ –∫—Ä—ã–ª–æ)",
            emergencyPhone: "103"
        };

        // State
        let currentLocation = "main_entrance";
        let currentBuilding = "main";
        let targetOffice = null;
        let selectedSpecialty = null;

        // ==================== HELPER FUNCTIONS ====================
        function getBuildingFloors(buildingId) {
            return Object.entries(floors)
                .filter(([id, f]) => f.building_id === buildingId)
                .sort((a, b) => a[1].number - b[1].number);
        }

        function getFloorZones(buildingId, floorNum) {
            const floorId = `${buildingId}_${floorNum}`;
            const floor = floors[floorId];
            if (!floor) return ['left', 'center', 'right'];
            return [...(floor.zones || []), ...(floor.custom_zones || [])];
        }

        function getFloorDisplayName(buildingId, floorNum) {
            const floorId = `${buildingId}_${floorNum}`;
            const floor = floors[floorId];
            if (floor && floor.name) return floor.name;
            if (floorNum < 0) return `–ü–æ–¥–≤–∞–ª ${Math.abs(floorNum)}`;
            if (floorNum === 0) return "–¶–æ–∫–æ–ª—å–Ω—ã–π —ç—Ç–∞–∂";
            return `${floorNum} —ç—Ç–∞–∂`;
        }

        function getZoneDisplayName(zone) {
            const names = { 
                left: '‚¨ÖÔ∏è –õ–µ–≤–æ–µ –∫—Ä—ã–ª–æ', 
                right: '‚û°Ô∏è –ü—Ä–∞–≤–æ–µ –∫—Ä—ã–ª–æ', 
                center: 'üèõÔ∏è –¶–µ–Ω—Ç—Ä/–•–æ–ª–ª',
                north: '‚¨ÜÔ∏è –°–µ–≤–µ—Ä–Ω–æ–µ –∫—Ä—ã–ª–æ',
                south: '‚¨áÔ∏è –Æ–∂–Ω–æ–µ –∫—Ä—ã–ª–æ'
            };
            return names[zone] || zone;
        }

        function getZoneShortName(zone) {
            const names = { left: '–ª–µ–≤–æ–µ', right: '–ø—Ä–∞–≤–æ–µ', center: '—Ü–µ–Ω—Ç—Ä', north: '—Å–µ–≤–µ—Ä–Ω–æ–µ', south: '—é–∂–Ω–æ–µ' };
            return names[zone] || zone;
        }

        function getBuildingColorClass(color) {
            const colors = { blue: 'bg-blue-500', green: 'bg-green-500', purple: 'bg-purple-500', orange: 'bg-orange-500', red: 'bg-red-500' };
            return colors[color] || 'bg-gray-500';
        }

        function getBuildingBorderClass(color) {
            const colors = { blue: 'border-blue-500', green: 'border-green-500', purple: 'border-purple-500', orange: 'border-orange-500', red: 'border-red-500' };
            return colors[color] || 'border-gray-500';
        }

        // ==================== NAVIGATION GRAPH ====================
        function generateNavGraph() {
            const nodes = {};
            const edges = [];
            
            for (const [buildingId, building] of Object.entries(buildings)) {
                nodes[`${buildingId}_entrance`] = { building: buildingId, floor: 1, name: `${building.short_name || building.name} ‚Äî –í—Ö–æ–¥` };
                
                const buildingFloors = getBuildingFloors(buildingId);
                const sortedFloorNums = buildingFloors.map(([id, f]) => f.number).sort((a, b) => a - b);
                
                // If no floors defined, create virtual floor 1
                if (sortedFloorNums.length === 0) {
                    sortedFloorNums.push(1);
                    nodes[`${buildingId}_floor1_center`] = { building: buildingId, floor: 1, name: `${building.short_name} ‚Äî 1 —ç—Ç–∞–∂, —Ö–æ–ª–ª` };
                    nodes[`${buildingId}_floor1_left`] = { building: buildingId, floor: 1, name: `${building.short_name} ‚Äî 1 —ç—Ç–∞–∂, –ª–µ–≤–æ–µ` };
                    nodes[`${buildingId}_floor1_right`] = { building: buildingId, floor: 1, name: `${building.short_name} ‚Äî 1 —ç—Ç–∞–∂, –ø—Ä–∞–≤–æ–µ` };
                    edges.push([`${buildingId}_floor1_center`, `${buildingId}_floor1_left`]);
                    edges.push([`${buildingId}_floor1_center`, `${buildingId}_floor1_right`]);
                }
                
                for (const [floorId, floor] of buildingFloors) {
                    const floorNum = floor.number;
                    const floorName = getFloorDisplayName(buildingId, floorNum);
                    
                    // Always create center node for the floor
                    const centerNodeId = `${buildingId}_floor${floorNum}_center`;
                    if (!nodes[centerNodeId]) {
                        nodes[centerNodeId] = { building: buildingId, floor: floorNum, name: `${building.short_name} ‚Äî ${floorName}, —Ö–æ–ª–ª` };
                    }
                    
                    const allZones = [...(floor.zones || []), ...(floor.custom_zones || [])];
                    for (const zone of allZones) {
                        if (zone !== 'center') {
                            const zoneNodeId = `${buildingId}_floor${floorNum}_${zone}`;
                            if (!nodes[zoneNodeId]) {
                                nodes[zoneNodeId] = { building: buildingId, floor: floorNum, name: `${building.short_name} ‚Äî ${floorName}, ${getZoneShortName(zone)}` };
                            }
                            edges.push([`${buildingId}_floor${floorNum}_center`, `${buildingId}_floor${floorNum}_${zone}`]);
                        }
                    }
                    
                    const floorIndex = sortedFloorNums.indexOf(floorNum);
                    if (floorIndex < sortedFloorNums.length - 1) {
                        const nextFloorNum = sortedFloorNums[floorIndex + 1];
                        const stairsId = `${buildingId}_stairs_${floorNum}_${nextFloorNum}`;
                        nodes[stairsId] = { building: buildingId, floor: floorNum, name: `${building.short_name} ‚Äî –ª–µ—Å—Ç–Ω–∏—Ü–∞ ${floorNum}‚Üí${nextFloorNum}` };
                        edges.push([`${buildingId}_floor${floorNum}_center`, stairsId]);
                        edges.push([stairsId, `${buildingId}_floor${nextFloorNum}_center`]);
                    }
                    
                    if (floor.has_elevator) {
                        const elevatorId = `${buildingId}_elevator_${floorNum}`;
                        nodes[elevatorId] = { building: buildingId, floor: floorNum, name: `${building.short_name} ‚Äî –ª–∏—Ñ—Ç, ${floorName}` };
                        edges.push([`${buildingId}_floor${floorNum}_center`, elevatorId]);
                        for (const [otherId, otherFloor] of buildingFloors) {
                            if (otherFloor.has_elevator && otherFloor.number !== floorNum) {
                                edges.push([elevatorId, `${buildingId}_elevator_${otherFloor.number}`]);
                            }
                        }
                    }
                }
                
                // Connect entrance to the first floor (prefer floor 1, otherwise the lowest floor)
                const firstFloor = sortedFloorNums.find(n => n >= 1) || sortedFloorNums[0] || 1;
                const firstFloorCenter = `${buildingId}_floor${firstFloor}_center`;
                if (nodes[firstFloorCenter]) {
                    edges.push([`${buildingId}_entrance`, firstFloorCenter]);
                }
            }
            
            // Add office nodes
            for (const [officeId, office] of Object.entries(offices)) {
                const nodeId = `office_${officeId}`;
                const roomNum = officeId.split('_')[1];
                nodes[nodeId] = { building: office.building_id, floor: office.floor, name: `–ö–∞–±. ${roomNum}` };
                
                // Connect office to wing or center
                const wingNode = `${office.building_id}_floor${office.floor}_${office.wing}`;
                const centerNode = `${office.building_id}_floor${office.floor}_center`;
                
                if (nodes[wingNode]) {
                    edges.push([wingNode, nodeId]);
                } else if (nodes[centerNode]) {
                    edges.push([centerNode, nodeId]);
                } else {
                    // Create the floor center node if it doesn't exist
                    const building = buildings[office.building_id];
                    nodes[centerNode] = { building: office.building_id, floor: office.floor, name: `${building?.short_name || office.building_id} ‚Äî ${office.floor} —ç—Ç–∞–∂, —Ö–æ–ª–ª` };
                    edges.push([`${office.building_id}_entrance`, centerNode]);
                    edges.push([centerNode, nodeId]);
                }
            }
            
            // Add transitions between connected buildings
            for (const [buildingId, building] of Object.entries(buildings)) {
                for (const connectedId of building.connections || []) {
                    if (!buildings[connectedId]) continue;
                    
                    const transitionId = `transition_${buildingId}_${connectedId}`;
                    const reverseId = `transition_${connectedId}_${buildingId}`;
                    
                    if (!nodes[transitionId] && !nodes[reverseId]) {
                        nodes[transitionId] = { building: buildingId, floor: 1, name: `–ü–µ—Ä–µ—Ö–æ–¥ –≤ ${buildings[connectedId]?.short_name || connectedId}` };
                        
                        // Find first floor centers for both buildings
                        const buildingFloors1 = getBuildingFloors(buildingId);
                        const sortedFloors1 = buildingFloors1.map(([id, f]) => f.number).sort((a, b) => a - b);
                        const floor1 = sortedFloors1.find(n => n >= 1) || sortedFloors1[0] || 1;
                        
                        const buildingFloors2 = getBuildingFloors(connectedId);
                        const sortedFloors2 = buildingFloors2.map(([id, f]) => f.number).sort((a, b) => a - b);
                        const floor2 = sortedFloors2.find(n => n >= 1) || sortedFloors2[0] || 1;
                        
                        const center1 = `${buildingId}_floor${floor1}_center`;
                        const center2 = `${connectedId}_floor${floor2}_center`;
                        
                        if (nodes[center1]) edges.push([center1, transitionId]);
                        if (nodes[center2]) edges.push([transitionId, center2]);
                    }
                }
            }
            
            // For disconnected buildings - add a global exit/street connection
            // This allows routing between any buildings via "exit to street"
            const buildingIds = Object.keys(buildings);
            if (buildingIds.length > 1) {
                nodes['street'] = { building: null, floor: 0, name: '–í—ã—Ö–æ–¥ –Ω–∞ —É–ª–∏—Ü—É' };
                
                for (const buildingId of buildingIds) {
                    edges.push([`${buildingId}_entrance`, 'street']);
                }
            }
            
            return { nodes, edges };
        }

        let navGraph = generateNavGraph();

        // ==================== INIT ====================
        function init() {
            loadData();
            navGraph = generateNavGraph();
            renderBuildingButtons();
            populateLocationSelect();
            updateLocationDisplay();
            renderSpecialties();
            renderAdminBuildings();
            renderAdminFloors();
            renderAdminSpecialties();
            renderAdminOffices();
            renderHelpScreen();
            // Update demo password hint
            const hint = document.getElementById('demo-password-hint');
            if (hint) hint.textContent = `–î–µ–º–æ-–ø–∞—Ä–æ–ª—å: ${settings.adminPassword}`;
        }

        function loadData() {
            const savedBuildings = localStorage.getItem('nav_buildings');
            const savedFloors = localStorage.getItem('nav_floors');
            const savedSpecialties = localStorage.getItem('nav_specialties');
            const savedOffices = localStorage.getItem('nav_offices');
            const savedSettings = localStorage.getItem('nav_settings');
            if (savedBuildings) buildings = JSON.parse(savedBuildings);
            if (savedFloors) floors = JSON.parse(savedFloors);
            if (savedSpecialties) specialties = JSON.parse(savedSpecialties);
            if (savedOffices) offices = JSON.parse(savedOffices);
            if (savedSettings) settings = { ...settings, ...JSON.parse(savedSettings) };
        }

        function saveData() {
            localStorage.setItem('nav_buildings', JSON.stringify(buildings));
            localStorage.setItem('nav_floors', JSON.stringify(floors));
            localStorage.setItem('nav_specialties', JSON.stringify(specialties));
            localStorage.setItem('nav_offices', JSON.stringify(offices));
            localStorage.setItem('nav_settings', JSON.stringify(settings));
        }

        // ==================== BUILDING SELECTION ====================
        function renderBuildingButtons() {
            const container = document.getElementById('building-buttons');
            if (!container) return;
            
            container.innerHTML = Object.entries(buildings).map(([id, building]) => {
                const isActive = currentBuilding === id;
                const colorClass = getBuildingColorClass(building.color);
                const borderClass = getBuildingBorderClass(building.color);
                return `
                    <button onclick="selectBuilding('${id}')" 
                            class="building-btn px-4 py-2 rounded-xl font-medium text-sm transition ${isActive ? colorClass + ' text-white shadow-lg' : 'bg-white/20 text-white border-2 border-white/30 hover:bg-white/30'}">
                        ${building.short_name || building.name}
                    </button>
                `;
            }).join('');
        }

        function selectBuilding(buildingId) {
            currentBuilding = buildingId;
            currentLocation = `${buildingId}_entrance`;
            renderBuildingButtons();
            populateLocationSelect();
            updateLocationDisplay();
        }

        function populateLocationSelect() {
            const select = document.getElementById('location-select');
            const routeSelect = document.getElementById('route-location-select');
            if (!select) return;
            
            let html = '';
            for (const [buildingId, building] of Object.entries(buildings)) {
                html += `<optgroup label="üè¢ ${building.name}">`;
                html += `<option value="${buildingId}_entrance" ${currentLocation === `${buildingId}_entrance` ? 'selected' : ''}>${building.short_name} ‚Äî –í—Ö–æ–¥</option>`;
                
                const buildingFloors = getBuildingFloors(buildingId);
                for (const [floorId, floor] of buildingFloors) {
                    const floorName = getFloorDisplayName(buildingId, floor.number);
                    html += `<option value="${buildingId}_floor${floor.number}_center" ${currentLocation === `${buildingId}_floor${floor.number}_center` ? 'selected' : ''}>${building.short_name} ‚Äî ${floorName}, —Ö–æ–ª–ª</option>`;
                    
                    const allZones = [...(floor.zones || []), ...(floor.custom_zones || [])];
                    for (const zone of allZones) {
                        if (zone !== 'center') {
                            const locId = `${buildingId}_floor${floor.number}_${zone}`;
                            html += `<option value="${locId}" ${currentLocation === locId ? 'selected' : ''}>${building.short_name} ‚Äî ${floorName}, ${getZoneShortName(zone)}</option>`;
                        }
                    }
                }
                html += '</optgroup>';
            }
            select.innerHTML = html;
            if (routeSelect) routeSelect.innerHTML = html;
        }

        function updateCurrentLocation() {
            const select = document.getElementById('location-select');
            if (!select) return;
            
            currentLocation = select.value;
            for (const buildingId of Object.keys(buildings)) {
                if (currentLocation.startsWith(buildingId)) {
                    currentBuilding = buildingId;
                    break;
                }
            }
            renderBuildingButtons();
            updateLocationDisplay();
        }

        function updateLocationFromRoute() {
            const select = document.getElementById('route-location-select');
            if (!select) return;
            
            currentLocation = select.value;
            for (const buildingId of Object.keys(buildings)) {
                if (currentLocation.startsWith(buildingId)) {
                    currentBuilding = buildingId;
                    break;
                }
            }
            
            // Sync main location select
            const mainSelect = document.getElementById('location-select');
            if (mainSelect) mainSelect.value = currentLocation;
            
            renderBuildingButtons();
            updateLocationDisplay();
            if (targetOffice) buildRoute();
        }

        function updateLocationDisplay() {
            const node = navGraph.nodes[currentLocation];
            const textEl = document.getElementById('current-location-text');
            if (textEl) {
                textEl.textContent = node?.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ç–æ—á–∫–∞';
            }
        }

        // ==================== SCREENS ====================
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('screen-' + screenId).classList.add('active');
            if (screenId === 'specialties') renderSpecialties();
        }

        function showHelp() { 
            renderHelpScreen();
            showScreen('help'); 
        }

        // ==================== SPECIALTIES ====================
        function renderSpecialties() {
            const container = document.getElementById('specialty-list');
            const search = document.getElementById('specialty-search')?.value.toLowerCase() || '';
            
            let html = '';
            for (const [id, spec] of Object.entries(specialties)) {
                const matches = spec.name.toLowerCase().includes(search) || spec.aliases.some(a => a.toLowerCase().includes(search));
                if (search && !matches) continue;
                
                const officeCount = Object.values(offices).filter(o => o.specialty_id === id).length;
                html += `
                    <button onclick="selectSpecialty('${id}')" 
                            class="btn-specialty w-full bg-white hover:bg-blue-50 border-2 border-gray-200 hover:border-blue-300 rounded-2xl p-4 text-left transition flex items-center gap-4">
                        <span class="text-3xl">${spec.icon || 'üè•'}</span>
                        <div class="flex-1">
                            <p class="font-semibold text-gray-800 text-lg">${spec.name}</p>
                            <p class="text-gray-500 text-sm">${officeCount} ${getOfficeWord(officeCount)}</p>
                        </div>
                        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </button>
                `;
            }
            container.innerHTML = html || '<p class="text-gray-500 text-center py-8">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>';
        }

        function filterSpecialties() { renderSpecialties(); }

        function getOfficeWord(count) {
            if (count === 1) return '–∫–∞–±–∏–Ω–µ—Ç';
            if (count >= 2 && count <= 4) return '–∫–∞–±–∏–Ω–µ—Ç–∞';
            return '–∫–∞–±–∏–Ω–µ—Ç–æ–≤';
        }

        function selectSpecialty(specId) {
            selectedSpecialty = specId;
            const specOffices = Object.entries(offices).filter(([id, o]) => o.specialty_id === specId);
            
            if (specOffices.length === 0) { showToast('–ö–∞–±–∏–Ω–µ—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã'); return; }
            if (specOffices.length === 1) { targetOffice = specOffices[0][0]; buildRoute(); return; }
            
            document.getElementById('rooms-specialty-name').textContent = `${specialties[specId].name} ‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞–±–∏–Ω–µ—Ç:`;
            
            const container = document.getElementById('room-list');
            container.innerHTML = specOffices.map(([id, office]) => {
                const building = buildings[office.building_id];
                const roomNum = id.split('_')[1];
                const colorClass = getBuildingColorClass(building?.color);
                const floorName = getFloorDisplayName(office.building_id, office.floor);
                return `
                <button onclick="selectRoom('${id}')" class="w-full bg-white hover:bg-blue-50 border-2 border-gray-200 hover:border-blue-300 rounded-2xl p-4 text-left transition">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-bold text-xl text-gray-800">–ö–∞–±–∏–Ω–µ—Ç ${roomNum}</p>
                            <p class="text-gray-600">${office.display_name}</p>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="inline-block px-2 py-0.5 ${colorClass} text-white text-xs rounded-full">${building?.short_name || office.building_id}</span>
                                <span class="text-gray-400 text-sm">${floorName}, ${getZoneShortName(office.wing)}</span>
                            </div>
                        </div>
                        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </div>
                </button>
            `}).join('');
            showScreen('rooms');
        }

        function selectRoom(officeId) { targetOffice = officeId; buildRoute(); }

        // ==================== ROOM SEARCH ====================
        function searchByRoom() {
            const input = document.getElementById('room-input').value.trim();
            if (!input) { showToast('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–∞–±–∏–Ω–µ—Ç–∞'); return; }
            
            const matchingOffices = Object.entries(offices).filter(([id, o]) => id.split('_')[1] === input);
            
            if (matchingOffices.length === 0) { showToast('–ö–∞–±–∏–Ω–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω'); return; }
            if (matchingOffices.length === 1) { targetOffice = matchingOffices[0][0]; buildRoute(); return; }
            
            document.getElementById('rooms-specialty-name').textContent = `–ö–∞–±–∏–Ω–µ—Ç ${input} ‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–ø—É—Å:`;
            
            const container = document.getElementById('room-list');
            container.innerHTML = matchingOffices.map(([id, office]) => {
                const building = buildings[office.building_id];
                const colorClass = getBuildingColorClass(building?.color);
                const floorName = getFloorDisplayName(office.building_id, office.floor);
                return `
                <button onclick="selectRoom('${id}')" class="w-full bg-white hover:bg-blue-50 border-2 border-gray-200 hover:border-blue-300 rounded-2xl p-4 text-left transition">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-bold text-xl text-gray-800">${building?.name || office.building_id}</p>
                            <p class="text-gray-600">${office.display_name}</p>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="inline-block px-2 py-0.5 ${colorClass} text-white text-xs rounded-full">${floorName}</span>
                                <span class="text-gray-400 text-sm">${getZoneShortName(office.wing)}</span>
                            </div>
                        </div>
                        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </div>
                </button>
            `}).join('');
            showScreen('rooms');
        }

        // ==================== ROUTING ====================
        function buildRoute() {
            if (!targetOffice || !offices[targetOffice]) { showToast('–ö–∞–±–∏–Ω–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω'); return; }
            
            const office = offices[targetOffice];
            const targetNode = `office_${targetOffice}`;
            const building = buildings[office.building_id];
            const roomNum = targetOffice.split('_')[1];
            
            const path = findPath(currentLocation, targetNode);
            if (!path) { showToast('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç'); return; }
            
            document.getElementById('route-target').textContent = `–ö–∞–±–∏–Ω–µ—Ç ${roomNum} ‚Äî ${office.display_name}`;
            document.getElementById('route-building').textContent = `üè¢ ${building?.name || office.building_id}`;
            
            const stepsContainer = document.getElementById('route-steps');
            const steps = generateInstructions(path, office);
            
            stepsContainer.innerHTML = steps.map((step, i) => `
                <div class="route-step flex items-start gap-4" style="animation-delay: ${i * 0.1}s">
                    <div class="w-10 h-10 ${i === steps.length - 1 ? 'bg-green-500' : 'bg-blue-500'} rounded-full flex items-center justify-center flex-shrink-0 text-white font-bold">
                        ${i === steps.length - 1 ? '‚úì' : i + 1}
                    </div>
                    <div class="flex-1 bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                        <p class="text-gray-800 ${i === steps.length - 1 ? 'font-bold' : ''}">${step}</p>
                    </div>
                </div>
            `).join('');
            
            // Update route location select
            const routeSelect = document.getElementById('route-location-select');
            if (routeSelect) routeSelect.value = currentLocation;
            
            showScreen('route');
        }

        function findPath(start, end) {
            if (start === end) return [start];
            navGraph = generateNavGraph();
            
            const adjacency = {};
            for (const node of Object.keys(navGraph.nodes)) adjacency[node] = [];
            for (const [a, b] of navGraph.edges) {
                if (adjacency[a]) adjacency[a].push(b);
                if (adjacency[b]) adjacency[b].push(a);
            }
            
            const queue = [[start]];
            const visited = new Set([start]);
            
            while (queue.length > 0) {
                const path = queue.shift();
                const node = path[path.length - 1];
                if (node === end) return path;
                for (const neighbor of adjacency[node] || []) {
                    if (!visited.has(neighbor)) {
                        visited.add(neighbor);
                        queue.push([...path, neighbor]);
                    }
                }
            }
            return null;
        }

        function generateInstructions(path, targetOffice) {
            const instructions = [];
            let prevFloor = navGraph.nodes[path[0]]?.floor || 1;
            let prevBuilding = navGraph.nodes[path[0]]?.building || currentBuilding;
            let exitedToStreet = false;
            
            for (let i = 0; i < path.length; i++) {
                const node = path[i];
                const nodeData = navGraph.nodes[node];
                const floor = nodeData?.floor || 1;
                const building = nodeData?.building;
                
                if (i === 0) { 
                    instructions.push(`üìç –í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å: ${nodeData?.name || node}`); 
                    continue; 
                }
                
                // Handle street node (exit building)
                if (node === 'street') {
                    instructions.push(`üö™ –í—ã–π–¥–∏—Ç–µ –∏–∑ –∑–¥–∞–Ω–∏—è –Ω–∞ —É–ª–∏—Ü—É`);
                    exitedToStreet = true;
                    continue;
                }
                
                // Handle entrance after street
                if (node.includes('_entrance') && exitedToStreet) {
                    const enterBuilding = node.split('_')[0];
                    instructions.push(`üè¢ –í–æ–π–¥–∏—Ç–µ –≤ ${buildings[enterBuilding]?.name || enterBuilding}`);
                    prevBuilding = enterBuilding;
                    exitedToStreet = false;
                    continue;
                }
                
                // Handle transition between connected buildings
                if (node.includes('transition_')) {
                    const parts = node.split('_');
                    const toBuilding = parts[2];
                    instructions.push(`üö∂ –ü—Ä–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ—Ö–æ–¥ –≤ ${buildings[toBuilding]?.name || toBuilding}`);
                    continue;
                }
                
                // Handle building change (for connected buildings)
                if (building && building !== prevBuilding && prevBuilding) {
                    // Only show if not already handled by transition or street
                    if (!path[i-1]?.includes('transition_') && !path[i-1]?.includes('_entrance')) {
                        instructions.push(`üö∂ –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ ${buildings[building]?.name || building}`);
                    }
                    prevBuilding = building;
                }
                
                // Handle elevator
                if (node.includes('_elevator_')) {
                    if (floor !== prevFloor) {
                        instructions.push(`üõó –ù–∞ –ª–∏—Ñ—Ç–µ –Ω–∞ ${getFloorDisplayName(building, floor)}`);
                        prevFloor = floor;
                    }
                    continue;
                }
                
                // Handle stairs (floor change)
                if (node.includes('_stairs_')) {
                    continue; // Stairs are intermediate, floor change will be shown
                }
                
                // Handle floor change
                if (floor > prevFloor) {
                    instructions.push(`‚¨ÜÔ∏è –ü–æ–¥–Ω–∏–º–∏—Ç–µ—Å—å –Ω–∞ ${getFloorDisplayName(building, floor)}`);
                    prevFloor = floor;
                } else if (floor < prevFloor && floor > 0) {
                    instructions.push(`‚¨áÔ∏è –°–ø—É—Å—Ç–∏—Ç–µ—Å—å –Ω–∞ ${getFloorDisplayName(building, floor)}`);
                    prevFloor = floor;
                }
                
                // Handle wing/zone navigation
                const zoneMatch = node.match(/_floor\d+_(\w+)$/);
                if (zoneMatch && zoneMatch[1] !== 'center' && !node.includes('office_')) {
                    instructions.push(`${getZoneIcon(zoneMatch[1])} –ò–¥–∏—Ç–µ –≤ ${getZoneShortName(zoneMatch[1])} –∫—Ä—ã–ª–æ`);
                }
                
                if (building) prevBuilding = building;
            }
            
            instructions.push(`üéØ –ö–∞–±–∏–Ω–µ—Ç "${targetOffice.display_name}" ‚Äî –≤—ã –Ω–∞ –º–µ—Å—Ç–µ!`);
            return instructions;
        }

        function getZoneIcon(zone) {
            const icons = { left: '‚¨ÖÔ∏è', right: '‚û°Ô∏è', center: 'üèõÔ∏è', north: '‚¨ÜÔ∏è', south: '‚¨áÔ∏è' };
            return icons[zone] || '‚û°Ô∏è';
        }

        // ==================== ADMIN ====================
        function adminLogin() {
            if (document.getElementById('admin-password').value === settings.adminPassword) {
                showScreen('admin');
                renderAdminBuildings();
                populateFloorBuildingSelect();
                renderAdminFloors();
                renderAdminSpecialties();
                renderAdminOffices();
                populateBuildingSelects();
            } else {
                showToast('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
            }
        }

        // ==================== SETTINGS ====================
        function populateSettingsForm() {
            document.getElementById('settings-phone').value = settings.phone || '';
            document.getElementById('settings-phone-desc').value = settings.phoneDesc || '';
            document.getElementById('settings-registry-location').value = settings.registryLocation || '';
            document.getElementById('settings-registry-hours').value = settings.registryHours || '';
            document.getElementById('settings-emergency-location').value = settings.emergencyLocation || '';
            document.getElementById('settings-emergency-phone').value = settings.emergencyPhone || '';
            document.getElementById('settings-current-password').value = '';
            document.getElementById('settings-new-password').value = '';
            document.getElementById('settings-confirm-password').value = '';
        }

        function changePassword() {
            const currentPassword = document.getElementById('settings-current-password').value;
            const newPassword = document.getElementById('settings-new-password').value;
            const confirmPassword = document.getElementById('settings-confirm-password').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }
            
            if (currentPassword !== settings.adminPassword) {
                showToast('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showToast('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                return;
            }
            
            if (newPassword.length < 4) {
                showToast('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 4 —Å–∏–º–≤–æ–ª–æ–≤');
                return;
            }
            
            settings.adminPassword = newPassword;
            saveData();
            document.getElementById('settings-current-password').value = '';
            document.getElementById('settings-new-password').value = '';
            document.getElementById('settings-confirm-password').value = '';
            showToast('–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω—ë–Ω');
        }

        function saveSettings() {
            settings.phone = document.getElementById('settings-phone').value.trim();
            settings.phoneDesc = document.getElementById('settings-phone-desc').value.trim();
            settings.registryLocation = document.getElementById('settings-registry-location').value.trim();
            settings.registryHours = document.getElementById('settings-registry-hours').value.trim();
            settings.emergencyLocation = document.getElementById('settings-emergency-location').value.trim();
            settings.emergencyPhone = document.getElementById('settings-emergency-phone').value.trim();
            
            saveData();
            showToast('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
        }

        function renderHelpScreen() {
            const container = document.getElementById('help-content');
            if (!container) return;
            
            const phoneLink = settings.phone.replace(/[^0-9+]/g, '');
            const emergencyPhoneLink = settings.emergencyPhone.replace(/[^0-9+]/g, '');
            
            container.innerHTML = `
                <div class="bg-white rounded-2xl shadow-md p-5">
                    <h3 class="font-semibold text-lg text-gray-800 mb-2 flex items-center gap-2">
                        <span class="text-2xl">üìç</span> –†–µ–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä–∞
                    </h3>
                    <p class="text-gray-600 mb-3">${settings.registryLocation || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</p>
                    ${settings.registryHours ? `<p class="text-gray-500 text-sm">–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: ${settings.registryHours}</p>` : ''}
                </div>

                <div class="bg-white rounded-2xl shadow-md p-5">
                    <h3 class="font-semibold text-lg text-gray-800 mb-2 flex items-center gap-2">
                        <span class="text-2xl">üìû</span> –¢–µ–ª–µ—Ñ–æ–Ω —Å–ø—Ä–∞–≤–æ—á–Ω–æ–π
                    </h3>
                    <a href="tel:${phoneLink}" class="text-blue-600 text-xl font-semibold">${settings.phone || '–ù–µ —É–∫–∞–∑–∞–Ω'}</a>
                    ${settings.phoneDesc ? `<p class="text-gray-500 text-sm mt-1">${settings.phoneDesc}</p>` : ''}
                </div>

                <div class="bg-white rounded-2xl shadow-md p-5">
                    <h3 class="font-semibold text-lg text-gray-800 mb-2 flex items-center gap-2">
                        <span class="text-2xl">üÜò</span> –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –ø–æ–º–æ—â—å
                    </h3>
                    <p class="text-gray-600">${settings.emergencyLocation || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</p>
                    ${settings.emergencyPhone ? `<a href="tel:${emergencyPhoneLink}" class="text-red-600 text-lg font-semibold mt-2 inline-block">üìû ${settings.emergencyPhone}</a>` : ''}
                </div>
            `;
        }

        function switchAdminTab(tab) {
            ['buildings', 'floors', 'specialties', 'offices', 'settings'].forEach(t => {
                const tabBtn = document.getElementById('tab-' + t);
                const content = document.getElementById('admin-' + t);
                if (t === tab) {
                    tabBtn.className = 'flex-1 py-2 px-2 rounded-lg font-medium transition text-xs bg-white shadow text-gray-800 whitespace-nowrap';
                    content.classList.remove('hidden');
                } else {
                    tabBtn.className = 'flex-1 py-2 px-2 rounded-lg font-medium transition text-xs text-gray-600 whitespace-nowrap';
                    content.classList.add('hidden');
                }
            });
            if (tab === 'floors') { populateFloorBuildingSelect(); renderAdminFloors(); }
            if (tab === 'offices') populateBuildingSelects();
            if (tab === 'settings') populateSettingsForm();
        }

        function populateBuildingSelects() {
            const officeSelect = document.getElementById('office-building-input');
            if (officeSelect) officeSelect.innerHTML = Object.entries(buildings).map(([id, b]) => `<option value="${id}">${b.name}</option>`).join('');
            
            const filterSelect = document.getElementById('admin-office-filter');
            if (filterSelect) filterSelect.innerHTML = '<option value="">–í—Å–µ –∫–æ—Ä–ø—É—Å–∞</option>' + Object.entries(buildings).map(([id, b]) => `<option value="${id}">${b.name}</option>`).join('');
            
            const connSelect = document.getElementById('building-connection-input');
            if (connSelect) {
                const editId = document.getElementById('edit-building-id')?.value;
                connSelect.innerHTML = '<option value="">–ù–µ—Ç —Å–≤—è–∑–∏ (–æ—Ç–¥–µ–ª—å–Ω–æ–µ –∑–¥–∞–Ω–∏–µ)</option>' + Object.entries(buildings).filter(([id]) => id !== editId).map(([id, b]) => `<option value="${id}">${b.name}</option>`).join('');
            }
        }

        function populateFloorBuildingSelect() {
            const select = document.getElementById('admin-floor-building-select');
            if (select) {
                const currentValue = select.value;
                select.innerHTML = Object.entries(buildings).map(([id, b]) => `<option value="${id}">${b.name}</option>`).join('');
                if (currentValue && buildings[currentValue]) select.value = currentValue;
            }
        }

        // ==================== ADMIN: BUILDINGS ====================
        function renderAdminBuildings() {
            const container = document.getElementById('admin-building-list');
            if (!container) return;
            
            container.innerHTML = Object.entries(buildings).map(([id, building]) => {
                const colorClass = getBuildingColorClass(building.color);
                const officeCount = Object.values(offices).filter(o => o.building_id === id).length;
                const floorCount = getBuildingFloors(id).length;
                return `
                <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center gap-3">
                            <span class="w-4 h-4 rounded-full ${colorClass}"></span>
                            <p class="font-bold text-lg text-gray-800">${building.name}</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editBuilding('${id}')" class="p-2 text-blue-500 hover:bg-blue-50 rounded-lg">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                            </button>
                            <button onclick="deleteBuilding('${id}')" class="p-2 text-red-500 hover:bg-red-50 rounded-lg">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                            </button>
                        </div>
                    </div>
                    <p class="text-gray-500 text-sm">${floorCount} ${getFloorWord(floorCount)} ‚Ä¢ ${officeCount} ${getOfficeWord(officeCount)}</p>
                    ${building.address ? `<p class="text-gray-400 text-sm">${building.address}</p>` : ''}
                    ${building.connections?.length ? `<p class="text-blue-500 text-sm mt-1">üîó –°–≤—è–∑—å: ${building.connections.map(c => buildings[c]?.short_name || c).join(', ')}</p>` : ''}
                </div>
            `}).join('');
        }

        function getFloorWord(count) {
            if (count === 1) return '—ç—Ç–∞–∂';
            if (count >= 2 && count <= 4) return '—ç—Ç–∞–∂–∞';
            return '—ç—Ç–∞–∂–µ–π';
        }

        function showAddBuilding() {
            document.getElementById('modal-building-title').textContent = '–î–æ–±–∞–≤–∏—Ç—å –∫–æ—Ä–ø—É—Å';
            document.getElementById('edit-building-id').value = '';
            document.getElementById('building-id-input').value = '';
            document.getElementById('building-id-input').disabled = false;
            document.getElementById('building-name-input').value = '';
            document.getElementById('building-short-input').value = '';
            document.getElementById('building-address-input').value = '';
            document.getElementById('building-color-input').value = 'blue';
            populateBuildingSelects();
            document.getElementById('building-connection-input').value = '';
            document.getElementById('modal-building').classList.remove('hidden');
        }

        function editBuilding(id) {
            const building = buildings[id];
            document.getElementById('modal-building-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä–ø—É—Å';
            document.getElementById('edit-building-id').value = id;
            document.getElementById('building-id-input').value = id;
            document.getElementById('building-id-input').disabled = true;
            document.getElementById('building-name-input').value = building.name;
            document.getElementById('building-short-input').value = building.short_name || '';
            document.getElementById('building-address-input').value = building.address || '';
            document.getElementById('building-color-input').value = building.color || 'blue';
            populateBuildingSelects();
            document.getElementById('building-connection-input').value = building.connections?.[0] || '';
            document.getElementById('modal-building').classList.remove('hidden');
        }

        function saveBuilding() {
            const editId = document.getElementById('edit-building-id').value;
            const id = editId || document.getElementById('building-id-input').value.trim().toLowerCase();
            const name = document.getElementById('building-name-input').value.trim();
            const shortName = document.getElementById('building-short-input').value.trim();
            const address = document.getElementById('building-address-input').value.trim();
            const color = document.getElementById('building-color-input').value;
            const connection = document.getElementById('building-connection-input').value;
            
            if (!id || !name) { showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è'); return; }
            
            const isNew = !buildings[id];
            buildings[id] = { name, short_name: shortName || name, address, color, connections: connection ? [connection] : [] };
            
            if (isNew) {
                floors[`${id}_1`] = { building_id: id, number: 1, name: "", zones: ["left", "center", "right"], custom_zones: [], description: "", has_elevator: false };
            }
            
            if (connection && buildings[connection]) {
                if (!buildings[connection].connections) buildings[connection].connections = [];
                if (!buildings[connection].connections.includes(id)) buildings[connection].connections.push(id);
            }
            
            navGraph = generateNavGraph();
            saveData();
            closeModal('building');
            renderAdminBuildings();
            renderBuildingButtons();
            populateLocationSelect();
            showToast('–ö–æ—Ä–ø—É—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
        }

        function deleteBuilding(id) {
            const officeCount = Object.values(offices).filter(o => o.building_id === id).length;
            if (officeCount > 0) { showToast(`–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å: –µ—Å—Ç—å ${officeCount} ${getOfficeWord(officeCount)}`); return; }
            
            if (confirm(`–£–¥–∞–ª–∏—Ç—å –∫–æ—Ä–ø—É—Å "${buildings[id].name}"?`)) {
                for (const floorId of Object.keys(floors)) {
                    if (floors[floorId].building_id === id) delete floors[floorId];
                }
                for (const b of Object.values(buildings)) {
                    if (b.connections) b.connections = b.connections.filter(c => c !== id);
                }
                delete buildings[id];
                if (currentBuilding === id) {
                    currentBuilding = Object.keys(buildings)[0] || 'main';
                    currentLocation = `${currentBuilding}_entrance`;
                }
                navGraph = generateNavGraph();
                saveData();
                renderAdminBuildings();
                renderBuildingButtons();
                populateLocationSelect();
                showToast('–ö–æ—Ä–ø—É—Å —É–¥–∞–ª—ë–Ω');
            }
        }

        // ==================== ADMIN: FLOORS ====================
        function renderAdminFloors() {
            const container = document.getElementById('admin-floor-list');
            const buildingId = document.getElementById('admin-floor-building-select')?.value;
            if (!container || !buildingId) return;
            
            const buildingFloors = getBuildingFloors(buildingId);
            if (buildingFloors.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">–ù–µ—Ç —ç—Ç–∞–∂–µ–π. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —ç—Ç–∞–∂.</p>';
                return;
            }
            
            container.innerHTML = buildingFloors.map(([floorId, floor]) => {
                const floorName = floor.name || `${floor.number} —ç—Ç–∞–∂`;
                const officeCount = Object.values(offices).filter(o => o.building_id === buildingId && o.floor === floor.number).length;
                const allZones = [...(floor.zones || []), ...(floor.custom_zones || [])];
                
                return `
                <div class="floor-card bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center gap-3">
                            <span class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center text-blue-600 font-bold text-lg">${floor.number}</span>
                            <div>
                                <p class="font-bold text-gray-800">${floorName}</p>
                                ${floor.description ? `<p class="text-gray-400 text-sm">${floor.description}</p>` : ''}
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editFloor('${floorId}')" class="p-2 text-blue-500 hover:bg-blue-50 rounded-lg">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                            </button>
                            <button onclick="deleteFloor('${floorId}')" class="p-2 text-red-500 hover:bg-red-50 rounded-lg">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                            </button>
                        </div>
                    </div>
                    <div class="flex flex-wrap gap-2 mt-2">
                        ${allZones.map(z => `<span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full">${getZoneShortName(z)}</span>`).join('')}
                        ${floor.has_elevator ? '<span class="px-2 py-1 bg-blue-100 text-blue-600 text-xs rounded-full">üõó –õ–∏—Ñ—Ç</span>' : ''}
                    </div>
                    <p class="text-gray-400 text-sm mt-2">${officeCount} ${getOfficeWord(officeCount)}</p>
                </div>
            `}).join('');
        }

        function showAddFloor() {
            const buildingId = document.getElementById('admin-floor-building-select')?.value;
            if (!buildingId) { showToast('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–ø—É—Å'); return; }
            
            document.getElementById('modal-floor-title').textContent = '–î–æ–±–∞–≤–∏—Ç—å —ç—Ç–∞–∂';
            document.getElementById('edit-floor-id').value = '';
            document.getElementById('edit-floor-building').value = buildingId;
            document.getElementById('floor-number-input').value = '';
            document.getElementById('floor-number-input').disabled = false;
            document.getElementById('floor-name-input').value = '';
            document.getElementById('floor-zone-left').checked = true;
            document.getElementById('floor-zone-center').checked = true;
            document.getElementById('floor-zone-right').checked = true;
            document.getElementById('floor-custom-zones-input').value = '';
            document.getElementById('floor-description-input').value = '';
            document.getElementById('floor-has-elevator').checked = false;
            document.getElementById('modal-floor').classList.remove('hidden');
        }

        function editFloor(floorId) {
            const floor = floors[floorId];
            if (!floor) return;
            
            document.getElementById('modal-floor-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–∞–∂';
            document.getElementById('edit-floor-id').value = floorId;
            document.getElementById('edit-floor-building').value = floor.building_id;
            document.getElementById('floor-number-input').value = floor.number;
            document.getElementById('floor-number-input').disabled = true;
            document.getElementById('floor-name-input').value = floor.name || '';
            document.getElementById('floor-zone-left').checked = (floor.zones || []).includes('left');
            document.getElementById('floor-zone-center').checked = (floor.zones || []).includes('center');
            document.getElementById('floor-zone-right').checked = (floor.zones || []).includes('right');
            document.getElementById('floor-custom-zones-input').value = (floor.custom_zones || []).join(', ');
            document.getElementById('floor-description-input').value = floor.description || '';
            document.getElementById('floor-has-elevator').checked = floor.has_elevator || false;
            document.getElementById('modal-floor').classList.remove('hidden');
        }

        function saveFloor() {
            const editId = document.getElementById('edit-floor-id').value;
            const buildingId = document.getElementById('edit-floor-building').value;
            const number = parseInt(document.getElementById('floor-number-input').value);
            const name = document.getElementById('floor-name-input').value.trim();
            const description = document.getElementById('floor-description-input').value.trim();
            const hasElevator = document.getElementById('floor-has-elevator').checked;
            
            if (isNaN(number)) { showToast('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —ç—Ç–∞–∂–∞'); return; }
            
            const zones = [];
            if (document.getElementById('floor-zone-left').checked) zones.push('left');
            if (document.getElementById('floor-zone-center').checked) zones.push('center');
            if (document.getElementById('floor-zone-right').checked) zones.push('right');
            
            const customZones = document.getElementById('floor-custom-zones-input').value.split(',').map(z => z.trim().toLowerCase()).filter(z => z);
            
            if (zones.length === 0 && customZones.length === 0) { showToast('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∑–æ–Ω—É'); return; }
            
            const floorId = editId || `${buildingId}_${number}`;
            if (!editId && floors[floorId]) { showToast('–≠—Ç–∞–∂ —Å —Ç–∞–∫–∏–º –Ω–æ–º–µ—Ä–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'); return; }
            
            floors[floorId] = { building_id: buildingId, number, name, zones, custom_zones: customZones, description, has_elevator: hasElevator };
            
            navGraph = generateNavGraph();
            saveData();
            closeModal('floor');
            renderAdminFloors();
            renderAdminBuildings();
            populateLocationSelect();
            showToast('–≠—Ç–∞–∂ —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
        }

        function deleteFloor(floorId) {
            const floor = floors[floorId];
            if (!floor) return;
            
            const officeCount = Object.values(offices).filter(o => o.building_id === floor.building_id && o.floor === floor.number).length;
            if (officeCount > 0) { showToast(`–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å: –µ—Å—Ç—å ${officeCount} ${getOfficeWord(officeCount)}`); return; }
            
            if (confirm(`–£–¥–∞–ª–∏—Ç—å "${floor.name || floor.number + ' —ç—Ç–∞–∂'}"?`)) {
                delete floors[floorId];
                navGraph = generateNavGraph();
                saveData();
                renderAdminFloors();
                renderAdminBuildings();
                populateLocationSelect();
                showToast('–≠—Ç–∞–∂ —É–¥–∞–ª—ë–Ω');
            }
        }

        // ==================== ADMIN: SPECIALTIES ====================
        function renderAdminSpecialties() {
            const container = document.getElementById('admin-specialty-list');
            if (!container) return;
            
            container.innerHTML = Object.entries(specialties).map(([id, spec]) => `
                <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100 flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <span class="text-2xl">${spec.icon || 'üè•'}</span>
                        <div>
                            <p class="font-semibold text-gray-800">${spec.name}</p>
                            <p class="text-gray-400 text-sm">ID: ${id}</p>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="editSpecialty('${id}')" class="p-2 text-blue-500 hover:bg-blue-50 rounded-lg">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                        </button>
                        <button onclick="deleteSpecialty('${id}')" class="p-2 text-red-500 hover:bg-red-50 rounded-lg">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function showAddSpecialty() {
            document.getElementById('modal-specialty-title').textContent = '–î–æ–±–∞–≤–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å';
            document.getElementById('edit-specialty-id').value = '';
            document.getElementById('specialty-id-input').value = '';
            document.getElementById('specialty-id-input').disabled = false;
            document.getElementById('specialty-name-input').value = '';
            document.getElementById('specialty-aliases-input').value = '';
            document.getElementById('specialty-icon-input').value = '';
            document.getElementById('modal-specialty').classList.remove('hidden');
        }

        function editSpecialty(id) {
            const spec = specialties[id];
            document.getElementById('modal-specialty-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å';
            document.getElementById('edit-specialty-id').value = id;
            document.getElementById('specialty-id-input').value = id;
            document.getElementById('specialty-id-input').disabled = true;
            document.getElementById('specialty-name-input').value = spec.name;
            document.getElementById('specialty-aliases-input').value = spec.aliases.join(', ');
            document.getElementById('specialty-icon-input').value = spec.icon || '';
            document.getElementById('modal-specialty').classList.remove('hidden');
        }

        function saveSpecialty() {
            const editId = document.getElementById('edit-specialty-id').value;
            const id = editId || document.getElementById('specialty-id-input').value.trim();
            const name = document.getElementById('specialty-name-input').value.trim();
            const aliases = document.getElementById('specialty-aliases-input').value.split(',').map(a => a.trim()).filter(a => a);
            const icon = document.getElementById('specialty-icon-input').value.trim() || 'üè•';
            
            if (!id || !name) { showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è'); return; }
            
            specialties[id] = { name, aliases, icon };
            saveData();
            closeModal('specialty');
            renderAdminSpecialties();
            renderSpecialties();
            showToast('–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞');
        }

        function deleteSpecialty(id) {
            if (confirm(`–£–¥–∞–ª–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å "${specialties[id].name}"?`)) {
                delete specialties[id];
                saveData();
                renderAdminSpecialties();
                renderSpecialties();
                showToast('–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å —É–¥–∞–ª–µ–Ω–∞');
            }
        }

        // ==================== ADMIN: OFFICES ====================
        function renderAdminOffices() {
            const container = document.getElementById('admin-office-list');
            if (!container) return;
            
            const filterBuilding = document.getElementById('admin-office-filter')?.value || '';
            const filteredOffices = Object.entries(offices).filter(([id, o]) => !filterBuilding || o.building_id === filterBuilding);
            
            container.innerHTML = filteredOffices.map(([id, office]) => {
                const building = buildings[office.building_id];
                const colorClass = getBuildingColorClass(building?.color);
                const roomNum = id.split('_')[1];
                const floorName = getFloorDisplayName(office.building_id, office.floor);
                return `
                <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center gap-2">
                            <span class="inline-block px-2 py-0.5 ${colorClass} text-white text-xs rounded-full">${building?.short_name || office.building_id}</span>
                            <p class="font-bold text-lg text-gray-800">–ö–∞–±. ${roomNum}</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editOffice('${id}')" class="p-2 text-blue-500 hover:bg-blue-50 rounded-lg">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                            </button>
                            <button onclick="deleteOffice('${id}')" class="p-2 text-red-500 hover:bg-red-50 rounded-lg">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                            </button>
                        </div>
                    </div>
                    <p class="text-gray-600">${office.display_name}</p>
                    <p class="text-gray-400 text-sm">${floorName}, ${getZoneShortName(office.wing)} ‚Ä¢ ${specialties[office.specialty_id]?.name || office.specialty_id}</p>
                    ${office.doctor_name ? `<p class="text-gray-400 text-sm mt-1">üë®‚Äç‚öïÔ∏è ${office.doctor_name}</p>` : ''}
                </div>
            `}).join('');
            
            if (filteredOffices.length === 0) container.innerHTML = '<p class="text-gray-500 text-center py-8">–ù–µ—Ç –∫–∞–±–∏–Ω–µ—Ç–æ–≤</p>';
        }

        function showAddOffice() {
            document.getElementById('modal-office-title').textContent = '–î–æ–±–∞–≤–∏—Ç—å –∫–∞–±–∏–Ω–µ—Ç';
            document.getElementById('edit-office-id').value = '';
            document.getElementById('office-number-input').value = '';
            document.getElementById('office-number-input').disabled = false;
            document.getElementById('office-name-input').value = '';
            document.getElementById('office-doctor-input').value = '';
            document.getElementById('office-schedule-input').value = '';
            document.getElementById('office-active-input').checked = true;
            populateBuildingSelects();
            populateSpecialtySelect();
            updateOfficeFloorOptions();
            document.getElementById('modal-office').classList.remove('hidden');
        }

        function editOffice(id) {
            const office = offices[id];
            const roomNum = id.split('_')[1];
            document.getElementById('modal-office-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–±–∏–Ω–µ—Ç';
            document.getElementById('edit-office-id').value = id;
            document.getElementById('office-number-input').value = roomNum;
            document.getElementById('office-number-input').disabled = true;
            document.getElementById('office-name-input').value = office.display_name || '';
            document.getElementById('office-doctor-input').value = office.doctor_name || '';
            document.getElementById('office-schedule-input').value = office.schedule || '';
            document.getElementById('office-active-input').checked = office.is_active !== false;
            populateBuildingSelects();
            document.getElementById('office-building-input').value = office.building_id;
            populateSpecialtySelect(office.specialty_id);
            updateOfficeFloorOptions();
            document.getElementById('office-floor-input').value = office.floor;
            updateOfficeWingOptions();
            document.getElementById('office-wing-input').value = office.wing;
            document.getElementById('modal-office').classList.remove('hidden');
        }

        function updateOfficeFloorOptions() {
            const buildingId = document.getElementById('office-building-input')?.value;
            const buildingFloors = getBuildingFloors(buildingId);
            const select = document.getElementById('office-floor-input');
            const currentValue = select.value;
            
            select.innerHTML = buildingFloors.map(([id, floor]) => `<option value="${floor.number}">${getFloorDisplayName(buildingId, floor.number)}</option>`).join('');
            
            if (buildingFloors.some(([id, f]) => f.number === parseInt(currentValue))) select.value = currentValue;
            updateOfficeWingOptions();
        }

        function updateOfficeWingOptions() {
            const buildingId = document.getElementById('office-building-input')?.value;
            const floorNum = parseInt(document.getElementById('office-floor-input')?.value);
            const zones = getFloorZones(buildingId, floorNum);
            const select = document.getElementById('office-wing-input');
            const currentValue = select.value;
            
            select.innerHTML = zones.map(zone => `<option value="${zone}">${getZoneDisplayName(zone)}</option>`).join('');
            if (zones.includes(currentValue)) select.value = currentValue;
        }

        function populateSpecialtySelect(selectedId = '') {
            const select = document.getElementById('office-specialty-input');
            select.innerHTML = Object.entries(specialties).map(([id, spec]) => `<option value="${id}" ${id === selectedId ? 'selected' : ''}>${spec.name}</option>`).join('');
        }

        function saveOffice() {
            const editId = document.getElementById('edit-office-id').value;
            const buildingId = document.getElementById('office-building-input').value;
            const num = document.getElementById('office-number-input').value.trim();
            const displayName = document.getElementById('office-name-input').value.trim();
            const specialtyId = document.getElementById('office-specialty-input').value;
            const floor = parseInt(document.getElementById('office-floor-input').value);
            const wing = document.getElementById('office-wing-input').value;
            const doctorName = document.getElementById('office-doctor-input').value.trim();
            const schedule = document.getElementById('office-schedule-input').value.trim();
            const isActive = document.getElementById('office-active-input').checked;
            
            if (!num || !specialtyId || !buildingId) { showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è'); return; }
            
            const officeId = editId || `${buildingId}_${num}`;
            if (editId && !editId.startsWith(buildingId)) delete offices[editId];
            
            offices[officeId] = { building_id: buildingId, floor, wing, specialty_id: specialtyId, display_name: displayName || `–ö–∞–±–∏–Ω–µ—Ç ${num}`, doctor_name: doctorName, schedule, is_active: isActive };
            
            navGraph = generateNavGraph();
            saveData();
            closeModal('office');
            renderAdminOffices();
            showToast('–ö–∞–±–∏–Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
        }

        function deleteOffice(id) {
            if (confirm(`–£–¥–∞–ª–∏—Ç—å –∫–∞–±–∏–Ω–µ—Ç ${id.split('_')[1]}?`)) {
                delete offices[id];
                navGraph = generateNavGraph();
                saveData();
                renderAdminOffices();
                showToast('–ö–∞–±–∏–Ω–µ—Ç —É–¥–∞–ª—ë–Ω');
            }
        }

        function closeModal(type) { document.getElementById('modal-' + type).classList.add('hidden'); }

        // ==================== TOAST ====================
        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-message').textContent = message;
            toast.classList.remove('translate-y-full');
            setTimeout(() => toast.classList.add('translate-y-full'), 3000);
        }

        // ==================== INIT ====================
        document.addEventListener('DOMContentLoaded', init);
        document.getElementById('room-input')?.addEventListener('keypress', (e) => { if (e.key === 'Enter') searchByRoom(); });
    </script>
</body>
</html>

